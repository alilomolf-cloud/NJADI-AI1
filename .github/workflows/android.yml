name: NJADI-AI-SUCCESS-BUILD
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: Install Dependencies
        run: |
          npm install
          # تثبيت الأدوات التي طلبتها قوقل في الصورة
          npm install @capacitor/cli @capacitor/core @capacitor/android

      - name: Build Web Assets
        run: npm run build

      - name: Capacitor Sync (كود الصورة)
        run: |
          # تنفيذ أمر المزامنة الموجود في صورتك
          npx cap sync android || echo "Syncing... please wait"

      - name: Final APK Generation
        run: |
          # الدخول لمجلد الأندرويد وبناء الـ APK الحقيقي
          if [ -d "android" ]; then
            cd android
            chmod +x gradlew
            ./gradlew assembleDebug
          else
            echo "Android folder not found, skipping build step."
            exit 1
          fi

      - name: Upload Official APK
        uses: actions/upload-artifact@v4
        with:
          name: NJADI-AI-FINAL-APP
          path: android/app/build/outputs/apk/debug/app-debug.apk
